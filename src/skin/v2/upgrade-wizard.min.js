/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => {
    // webpackBootstrap
    /******/ var __webpack_modules__ = {
        /***/ "./node_modules/bs-stepper/dist/css/bs-stepper.min.css":
            /*!*************************************************************!*\
  !*** ./node_modules/bs-stepper/dist/css/bs-stepper.min.css ***!
  \*************************************************************/
            /***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
                "use strict";
                eval(
                    "{__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://churchcrm/./node_modules/bs-stepper/dist/css/bs-stepper.min.css?\n}",
                );

                /***/
            },

        /***/ "./node_modules/bs-stepper/dist/js/bs-stepper.js":
            /*!*******************************************************!*\
  !*** ./node_modules/bs-stepper/dist/js/bs-stepper.js ***!
  \*******************************************************/
            /***/ function (module) {
                eval(
                    "{/*!\n * bsStepper v1.7.0 (https://github.com/Johann-S/bs-stepper)\n * Copyright 2018 - 2019 Johann-S <johann.servoire@gmail.com>\n * Licensed under MIT (https://github.com/Johann-S/bs-stepper/blob/master/LICENSE)\n */\n(function (global, factory) {\n   true ? module.exports = factory() :\n  0;\n}(this, function () { 'use strict';\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  var matches = window.Element.prototype.matches;\n\n  var closest = function closest(element, selector) {\n    return element.closest(selector);\n  };\n\n  var WinEvent = function WinEvent(inType, params) {\n    return new window.Event(inType, params);\n  };\n\n  var createCustomEvent = function createCustomEvent(eventName, params) {\n    var cEvent = new window.CustomEvent(eventName, params);\n    return cEvent;\n  };\n  /* istanbul ignore next */\n\n\n  function polyfill() {\n    if (!window.Element.prototype.matches) {\n      matches = window.Element.prototype.msMatchesSelector || window.Element.prototype.webkitMatchesSelector;\n    }\n\n    if (!window.Element.prototype.closest) {\n      closest = function closest(element, selector) {\n        if (!document.documentElement.contains(element)) {\n          return null;\n        }\n\n        do {\n          if (matches.call(element, selector)) {\n            return element;\n          }\n\n          element = element.parentElement || element.parentNode;\n        } while (element !== null && element.nodeType === 1);\n\n        return null;\n      };\n    }\n\n    if (!window.Event || typeof window.Event !== 'function') {\n      WinEvent = function WinEvent(inType, params) {\n        params = params || {};\n        var e = document.createEvent('Event');\n        e.initEvent(inType, Boolean(params.bubbles), Boolean(params.cancelable));\n        return e;\n      };\n    }\n\n    if (typeof window.CustomEvent !== 'function') {\n      var originPreventDefault = window.Event.prototype.preventDefault;\n\n      createCustomEvent = function createCustomEvent(eventName, params) {\n        var evt = document.createEvent('CustomEvent');\n        params = params || {\n          bubbles: false,\n          cancelable: false,\n          detail: null\n        };\n        evt.initCustomEvent(eventName, params.bubbles, params.cancelable, params.detail);\n\n        evt.preventDefault = function () {\n          if (!this.cancelable) {\n            return;\n          }\n\n          originPreventDefault.call(this);\n          Object.defineProperty(this, 'defaultPrevented', {\n            get: function get() {\n              return true;\n            }\n          });\n        };\n\n        return evt;\n      };\n    }\n  }\n\n  polyfill();\n\n  var MILLISECONDS_MULTIPLIER = 1000;\n  var ClassName = {\n    ACTIVE: 'active',\n    LINEAR: 'linear',\n    BLOCK: 'dstepper-block',\n    NONE: 'dstepper-none',\n    FADE: 'fade',\n    VERTICAL: 'vertical'\n  };\n  var transitionEndEvent = 'transitionend';\n  var customProperty = 'bsStepper';\n\n  var show = function show(stepperNode, indexStep, options, done) {\n    var stepper = stepperNode[customProperty];\n\n    if (stepper._steps[indexStep].classList.contains(ClassName.ACTIVE) || stepper._stepsContents[indexStep].classList.contains(ClassName.ACTIVE)) {\n      return;\n    }\n\n    var showEvent = createCustomEvent('show.bs-stepper', {\n      cancelable: true,\n      detail: {\n        from: stepper._currentIndex,\n        to: indexStep,\n        indexStep: indexStep\n      }\n    });\n    stepperNode.dispatchEvent(showEvent);\n\n    var activeStep = stepper._steps.filter(function (step) {\n      return step.classList.contains(ClassName.ACTIVE);\n    });\n\n    var activeContent = stepper._stepsContents.filter(function (content) {\n      return content.classList.contains(ClassName.ACTIVE);\n    });\n\n    if (showEvent.defaultPrevented) {\n      return;\n    }\n\n    if (activeStep.length) {\n      activeStep[0].classList.remove(ClassName.ACTIVE);\n    }\n\n    if (activeContent.length) {\n      activeContent[0].classList.remove(ClassName.ACTIVE);\n\n      if (!stepperNode.classList.contains(ClassName.VERTICAL) && !stepper.options.animation) {\n        activeContent[0].classList.remove(ClassName.BLOCK);\n      }\n    }\n\n    showStep(stepperNode, stepper._steps[indexStep], stepper._steps, options);\n    showContent(stepperNode, stepper._stepsContents[indexStep], stepper._stepsContents, activeContent, done);\n  };\n\n  var showStep = function showStep(stepperNode, step, stepList, options) {\n    stepList.forEach(function (step) {\n      var trigger = step.querySelector(options.selectors.trigger);\n      trigger.setAttribute('aria-selected', 'false'); // if stepper is in linear mode, set disabled attribute on the trigger\n\n      if (stepperNode.classList.contains(ClassName.LINEAR)) {\n        trigger.setAttribute('disabled', 'disabled');\n      }\n    });\n    step.classList.add(ClassName.ACTIVE);\n    var currentTrigger = step.querySelector(options.selectors.trigger);\n    currentTrigger.setAttribute('aria-selected', 'true'); // if stepper is in linear mode, remove disabled attribute on current\n\n    if (stepperNode.classList.contains(ClassName.LINEAR)) {\n      currentTrigger.removeAttribute('disabled');\n    }\n  };\n\n  var showContent = function showContent(stepperNode, content, contentList, activeContent, done) {\n    var stepper = stepperNode[customProperty];\n    var toIndex = contentList.indexOf(content);\n    var shownEvent = createCustomEvent('shown.bs-stepper', {\n      cancelable: true,\n      detail: {\n        from: stepper._currentIndex,\n        to: toIndex,\n        indexStep: toIndex\n      }\n    });\n\n    function complete() {\n      content.classList.add(ClassName.BLOCK);\n      content.removeEventListener(transitionEndEvent, complete);\n      stepperNode.dispatchEvent(shownEvent);\n      done();\n    }\n\n    if (content.classList.contains(ClassName.FADE)) {\n      content.classList.remove(ClassName.NONE);\n      var duration = getTransitionDurationFromElement(content);\n      content.addEventListener(transitionEndEvent, complete);\n\n      if (activeContent.length) {\n        activeContent[0].classList.add(ClassName.NONE);\n      }\n\n      content.classList.add(ClassName.ACTIVE);\n      emulateTransitionEnd(content, duration);\n    } else {\n      content.classList.add(ClassName.ACTIVE);\n      content.classList.add(ClassName.BLOCK);\n      stepperNode.dispatchEvent(shownEvent);\n      done();\n    }\n  };\n\n  var getTransitionDurationFromElement = function getTransitionDurationFromElement(element) {\n    if (!element) {\n      return 0;\n    } // Get transition-duration of the element\n\n\n    var transitionDuration = window.getComputedStyle(element).transitionDuration;\n    var floatTransitionDuration = parseFloat(transitionDuration); // Return 0 if element or transition duration is not found\n\n    if (!floatTransitionDuration) {\n      return 0;\n    } // If multiple durations are defined, take the first\n\n\n    transitionDuration = transitionDuration.split(',')[0];\n    return parseFloat(transitionDuration) * MILLISECONDS_MULTIPLIER;\n  };\n\n  var emulateTransitionEnd = function emulateTransitionEnd(element, duration) {\n    var called = false;\n    var durationPadding = 5;\n    var emulatedDuration = duration + durationPadding;\n\n    function listener() {\n      called = true;\n      element.removeEventListener(transitionEndEvent, listener);\n    }\n\n    element.addEventListener(transitionEndEvent, listener);\n    window.setTimeout(function () {\n      if (!called) {\n        element.dispatchEvent(WinEvent(transitionEndEvent));\n      }\n\n      element.removeEventListener(transitionEndEvent, listener);\n    }, emulatedDuration);\n  };\n\n  var detectAnimation = function detectAnimation(contentList, options) {\n    if (options.animation) {\n      contentList.forEach(function (content) {\n        content.classList.add(ClassName.FADE);\n        content.classList.add(ClassName.NONE);\n      });\n    }\n  };\n\n  var buildClickStepLinearListener = function buildClickStepLinearListener() {\n    return function clickStepLinearListener(event) {\n      event.preventDefault();\n    };\n  };\n\n  var buildClickStepNonLinearListener = function buildClickStepNonLinearListener(options) {\n    return function clickStepNonLinearListener(event) {\n      event.preventDefault();\n      var step = closest(event.target, options.selectors.steps);\n      var stepperNode = closest(step, options.selectors.stepper);\n      var stepper = stepperNode[customProperty];\n\n      var stepIndex = stepper._steps.indexOf(step);\n\n      show(stepperNode, stepIndex, options, function () {\n        stepper._currentIndex = stepIndex;\n      });\n    };\n  };\n\n  var DEFAULT_OPTIONS = {\n    linear: true,\n    animation: false,\n    selectors: {\n      steps: '.step',\n      trigger: '.step-trigger',\n      stepper: '.bs-stepper'\n    }\n  };\n\n  var Stepper =\n  /*#__PURE__*/\n  function () {\n    function Stepper(element, _options) {\n      var _this = this;\n\n      if (_options === void 0) {\n        _options = {};\n      }\n\n      this._element = element;\n      this._currentIndex = 0;\n      this._stepsContents = [];\n      this.options = _extends({}, DEFAULT_OPTIONS, {}, _options);\n      this.options.selectors = _extends({}, DEFAULT_OPTIONS.selectors, {}, this.options.selectors);\n\n      if (this.options.linear) {\n        this._element.classList.add(ClassName.LINEAR);\n      }\n\n      this._steps = [].slice.call(this._element.querySelectorAll(this.options.selectors.steps));\n\n      this._steps.filter(function (step) {\n        return step.hasAttribute('data-target');\n      }).forEach(function (step) {\n        _this._stepsContents.push(_this._element.querySelector(step.getAttribute('data-target')));\n      });\n\n      detectAnimation(this._stepsContents, this.options);\n\n      this._setLinkListeners();\n\n      Object.defineProperty(this._element, customProperty, {\n        value: this,\n        writable: true\n      });\n\n      if (this._steps.length) {\n        show(this._element, this._currentIndex, this.options, function () {});\n      }\n    } // Private\n\n\n    var _proto = Stepper.prototype;\n\n    _proto._setLinkListeners = function _setLinkListeners() {\n      var _this2 = this;\n\n      this._steps.forEach(function (step) {\n        var trigger = step.querySelector(_this2.options.selectors.trigger);\n\n        if (_this2.options.linear) {\n          _this2._clickStepLinearListener = buildClickStepLinearListener(_this2.options);\n          trigger.addEventListener('click', _this2._clickStepLinearListener);\n        } else {\n          _this2._clickStepNonLinearListener = buildClickStepNonLinearListener(_this2.options);\n          trigger.addEventListener('click', _this2._clickStepNonLinearListener);\n        }\n      });\n    } // Public\n    ;\n\n    _proto.next = function next() {\n      var _this3 = this;\n\n      var nextStep = this._currentIndex + 1 <= this._steps.length - 1 ? this._currentIndex + 1 : this._steps.length - 1;\n      show(this._element, nextStep, this.options, function () {\n        _this3._currentIndex = nextStep;\n      });\n    };\n\n    _proto.previous = function previous() {\n      var _this4 = this;\n\n      var previousStep = this._currentIndex - 1 >= 0 ? this._currentIndex - 1 : 0;\n      show(this._element, previousStep, this.options, function () {\n        _this4._currentIndex = previousStep;\n      });\n    };\n\n    _proto.to = function to(stepNumber) {\n      var _this5 = this;\n\n      var tempIndex = stepNumber - 1;\n      var nextStep = tempIndex >= 0 && tempIndex < this._steps.length ? tempIndex : 0;\n      show(this._element, nextStep, this.options, function () {\n        _this5._currentIndex = nextStep;\n      });\n    };\n\n    _proto.reset = function reset() {\n      var _this6 = this;\n\n      show(this._element, 0, this.options, function () {\n        _this6._currentIndex = 0;\n      });\n    };\n\n    _proto.destroy = function destroy() {\n      var _this7 = this;\n\n      this._steps.forEach(function (step) {\n        var trigger = step.querySelector(_this7.options.selectors.trigger);\n\n        if (_this7.options.linear) {\n          trigger.removeEventListener('click', _this7._clickStepLinearListener);\n        } else {\n          trigger.removeEventListener('click', _this7._clickStepNonLinearListener);\n        }\n      });\n\n      this._element[customProperty] = undefined;\n      this._element = undefined;\n      this._currentIndex = undefined;\n      this._steps = undefined;\n      this._stepsContents = undefined;\n      this._clickStepLinearListener = undefined;\n      this._clickStepNonLinearListener = undefined;\n    };\n\n    return Stepper;\n  }();\n\n  return Stepper;\n\n}));\n//# sourceMappingURL=bs-stepper.js.map\n\n\n//# sourceURL=webpack://churchcrm/./node_modules/bs-stepper/dist/js/bs-stepper.js?\n}",
                );

                /***/
            },

        /***/ "./webpack/upgrade-wizard-app.js":
            /*!***************************************!*\
  !*** ./webpack/upgrade-wizard-app.js ***!
  \***************************************/
            /***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
                "use strict";
                eval(
                    "{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var bs_stepper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bs-stepper */ \"./node_modules/bs-stepper/dist/js/bs-stepper.js\");\n/* harmony import */ var bs_stepper__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bs_stepper__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bs_stepper_dist_css_bs_stepper_min_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bs-stepper/dist/css/bs-stepper.min.css */ \"./node_modules/bs-stepper/dist/css/bs-stepper.min.css\");\n/**\n * Upgrade Wizard Application Logic\n * Handles the upgrade wizard workflow using bs-stepper\n */\n\n\n\n\nlet upgradeStepper;\n\n/**\n * Initialize the upgrade wizard when DOM is ready\n */\n$(document).ready(function () {\n    // Initialize bs-stepper\n    upgradeStepper = new (bs_stepper__WEBPACK_IMPORTED_MODULE_0___default())(document.querySelector('#upgrade-stepper'), {\n        linear: true,\n        animation: true\n    });\n\n    // Set up event handlers\n    setupNavigationHandlers();\n    setupStepHandlers();\n    setupPrereleaseToggle();\n    setupRefreshButton();\n    setupForceReinstallButton();\n    \n    // Listen for step changes to auto-download when reaching apply step\n    document.querySelector('#upgrade-stepper').addEventListener('show.bs-stepper', function (event) {\n        // Auto-download when entering the apply step\n        if (event.detail.to === 2) { // Index 2 is now the apply step (0: warnings, 1: backup, 2: apply)\n            setTimeout(function() {\n                autoDownloadUpdate();\n            }, 300);\n        }\n    });\n});\n\n/**\n * Set up navigation button handlers\n */\nfunction setupNavigationHandlers() {\n    // Warning step - accept and continue\n    $(\"#acceptWarnings\").click(function () {\n        upgradeStepper.next();\n    });\n\n    // Backup step navigation\n    $(\"#backup-next\").click(function () {\n        upgradeStepper.next();\n    });\n}\n\n/**\n * Set up handlers for each step's actions\n */\nfunction setupStepHandlers() {\n    setupBackupStep();\n    setupApplyStep();\n}\n\n/**\n * Set up database backup step\n */\nfunction setupBackupStep() {\n    $(\"#doBackup\").click(function () {\n        const $button = $(this);\n        const $statusIcon = $(\"#status-backup\");\n        const $backupStatus = $(\"#backupStatus\");\n        const $resultFiles = $(\"#resultFiles\");\n        const $navButtons = $(\"#backupNavButtons\");\n\n        // Show loading state\n        $statusIcon.html('<i class=\"fa-solid fa-circle-notch fa-spin text-primary\"></i>');\n        $button.prop('disabled', true);\n\n        window.CRM.APIRequest({\n            method: 'POST',\n            path: 'database/backup',\n            data: JSON.stringify({\n                'BackupType': 3\n            })\n        })\n            .done(function (data) {\n                const downloadButton = `<button class=\"btn btn-success btn-lg btn-block\" id=\"downloadbutton\" role=\"button\" onclick=\"window.UpgradeWizard.downloadBackup('${data.BackupDownloadFileName}')\" style=\"max-width: 500px;\">\n                <i class=\"fa-solid fa-download mr-2\"></i>${data.BackupDownloadFileName}\n            </button>`;\n\n                $backupStatus.html(`<div class=\"alert alert-success\" style=\"background-color: #d4edda; border-color: #c3e6cb; color: #155724;\">\n                <i class=\"fa-solid fa-check-circle mr-2\"></i><strong>${i18next.t('Backup Complete, Ready for Download.')}</strong>\n            </div>`);\n                $resultFiles.html(downloadButton);\n                $statusIcon.html('<i class=\"fa-solid fa-check text-success\"></i>');\n                $navButtons.show();\n\n                // Handle download button click\n                $(\"#downloadbutton\").click(function () {\n                    $(this).prop('disabled', true).html(`<i class=\"fa-solid fa-check mr-2\"></i>${i18next.t('Downloaded')}`);\n                });\n            })\n            .fail(function (xhr, status, error) {\n                let errorMessage = i18next.t('Failed to create backup.');\n                \n                if (xhr.responseJSON && xhr.responseJSON.message) {\n                    errorMessage = '<strong>' + i18next.t('Failed to create backup.') + '</strong><br>' + xhr.responseJSON.message;\n                } else if (xhr.responseText) {\n                    try {\n                        const response = JSON.parse(xhr.responseText);\n                        if (response.message) {\n                            errorMessage = '<strong>' + i18next.t('Failed to create backup.') + '</strong><br>' + response.message;\n                        }\n                    } catch (e) {\n                        errorMessage = '<strong>' + i18next.t('Failed to create backup.') + '</strong><br>' + xhr.status + ': ' + xhr.statusText;\n                    }\n                } else if (error) {\n                    errorMessage = '<strong>' + i18next.t('Failed to create backup.') + '</strong><br>' + error;\n                }\n\n                $backupStatus.html(`<div class=\"alert alert-danger\" style=\"background-color: #f8d7da; border-color: #f5c6cb; color: #721c24;\">\n                <i class=\"fa-solid fa-times-circle mr-2\"></i>${errorMessage}\n            </div>`);\n                $statusIcon.html('<i class=\"fa-solid fa-times text-danger\"></i>');\n                $button.prop('disabled', false);\n            });\n    });\n\n    // Skip Backup button handler\n    $('#skipBackup').click(function () {\n        const $statusIcon = $(\"#status-backup\");\n        const $backupStatus = $(\"#backupStatus\");\n        const $navButtons = $(\"#backupNavButtons\");\n        const $button = $(this);\n\n        $backupStatus.html(`<div class=\"alert alert-warning\" style=\"background-color: #fff3cd; border-color: #ffeaa7; color: #856404;\">\n            <i class=\"fa-solid fa-exclamation-triangle mr-2\"></i><strong>${i18next.t('Backup Skipped')}</strong><br>\n            ${i18next.t('You have chosen to skip the backup. It is strongly recommended to have a backup before proceeding with the upgrade.')}\n        </div>`);\n        $statusIcon.html('<i class=\"fa-solid fa-exclamation-triangle text-warning\"></i>');\n        $button.hide();\n        $navButtons.show();\n    });\n}\n\n/**\n * Auto-download update when step is shown\n */\nfunction autoDownloadUpdate() {\n    const $statusIcon = $(\"#status-apply\");\n    const $downloadStatus = $(\"#downloadStatus\");\n    \n    // Check if already downloaded\n    if (window.CRM.updateFile) {\n        // Already downloaded, show details and apply button\n        $(\"#updateDetails\").show();\n        $(\"#applyButtonContainer\").show();\n        return;\n    }\n    \n    // Show that auto-download is happening\n    $statusIcon.html('<i class=\"fa-solid fa-circle-notch fa-spin text-primary\"></i>');\n    $downloadStatus.html(`<div class=\"alert alert-info\">\n        <i class=\"fa-solid fa-cloud-download mr-2\"></i>${i18next.t('Downloading latest release from GitHub...')}\n    </div>`);\n    \n    performDownload();\n}\n\n/**\n * Perform the actual download operation\n */\nfunction performDownload() {\n    const $statusIcon = $(\"#status-apply\");\n    const $downloadStatus = $(\"#downloadStatus\");\n\n    window.CRM.APIRequest({\n        type: 'GET',\n        path: 'systemupgrade/download-latest-release',\n    })\n        .done(function (data) {\n            $statusIcon.html('<i class=\"fa-solid fa-check text-success\"></i>');\n            window.CRM.updateFile = data;\n\n            $downloadStatus.html(`<div class=\"alert alert-success\">\n            <i class=\"fa-solid fa-check-circle mr-2\"></i>${i18next.t('Update package downloaded successfully.')}\n        </div>`);\n\n            // Show update details\n            $(\"#updateFileName\").text(data.fileName);\n            $(\"#updateFullPath\").text(data.fullPath);\n            $(\"#releaseNotes\").text(data.releaseNotes);\n            $(\"#updateSHA1\").text(data.sha1);\n            $(\"#updateDetails\").show();\n            \n            // Show apply button after download completes\n            $(\"#applyButtonContainer\").show();\n        })\n        .fail(function (xhr, status, error) {\n            let errorMessage = i18next.t('Failed to download update package.');\n            \n            if (xhr.responseJSON && xhr.responseJSON.message) {\n                errorMessage = '<strong>' + i18next.t('Failed to download update package.') + '</strong><br>' + xhr.responseJSON.message;\n            } else if (xhr.responseText) {\n                try {\n                    const response = JSON.parse(xhr.responseText);\n                    if (response.message) {\n                        errorMessage = '<strong>' + i18next.t('Failed to download update package.') + '</strong><br>' + response.message;\n                    }\n                } catch (e) {\n                    errorMessage = '<strong>' + i18next.t('Failed to download update package.') + '</strong><br>' + xhr.status + ': ' + xhr.statusText;\n                }\n            } else if (error) {\n                errorMessage = '<strong>' + i18next.t('Failed to download update package.') + '</strong><br>' + error;\n            }\n\n            $downloadStatus.html(`<div class=\"alert alert-danger\" style=\"background-color: #f8d7da; border-color: #f5c6cb; color: #721c24;\">\n            <i class=\"fa-solid fa-times-circle mr-2\"></i>${errorMessage}\n        </div>`);\n            $statusIcon.html('<i class=\"fa-solid fa-times text-danger\"></i>');\n            \n            // Show manual retry button\n            $downloadStatus.append(`<button class=\"btn btn-warning mt-2\" id=\"retryDownload\">\n                <i class=\"fa-solid fa-redo mr-2\"></i>${i18next.t('Retry Download')}\n            </button>`);\n            \n            $(\"#retryDownload\").click(function() {\n                $(this).remove();\n                performDownload();\n            });\n        });\n}\n\n/**\n * Set up apply update step\n */\nfunction setupApplyStep() {\n    $(\"#applyUpdate\").click(function () {\n        const $button = $(this);\n        const $statusIcon = $(\"#status-apply\");\n        const $applyStatus = $(\"#applyStatus\");\n        const $spinner = $(\"#upgradeSpinner\");\n\n        // Show full-page spinner\n        $spinner.addClass('active');\n\n        // Show loading state\n        $statusIcon.html('<i class=\"fa-solid fa-circle-notch fa-spin text-primary\"></i>');\n        $button.prop('disabled', true);\n\n        window.CRM.APIRequest({\n            method: 'POST',\n            path: 'systemupgrade/do-upgrade',\n            data: JSON.stringify({\n                fullPath: window.CRM.updateFile.fullPath,\n                sha1: window.CRM.updateFile.sha1\n            })\n        })\n            .done(function (data) {\n                // Hide spinner\n                $spinner.removeClass('active');\n                \n                $statusIcon.html('<i class=\"fa-solid fa-check text-success\"></i>');\n                $applyStatus.html(`<div class=\"alert alert-success\" style=\"background-color: #d4edda; border-color: #c3e6cb; color: #155724;\">\n                <i class=\"fa-solid fa-check-circle mr-2\"></i><strong>${i18next.t('System upgrade completed successfully!')}</strong>\n            </div>`);\n\n                // Auto-advance to final step\n                setTimeout(function () {\n                    upgradeStepper.next();\n                }, 1000);\n            })\n            .fail(function (xhr, status, error) {\n                // Hide spinner\n                $spinner.removeClass('active');\n                \n                let errorMessage = i18next.t('Upgrade failed. Please check the logs.');\n                \n                if (xhr.responseJSON && xhr.responseJSON.message) {\n                    errorMessage = '<strong>' + i18next.t('Upgrade failed.') + '</strong><br>' + xhr.responseJSON.message;\n                } else if (xhr.responseText) {\n                    try {\n                        const response = JSON.parse(xhr.responseText);\n                        if (response.message) {\n                            errorMessage = '<strong>' + i18next.t('Upgrade failed.') + '</strong><br>' + response.message;\n                        }\n                    } catch (e) {\n                        errorMessage = '<strong>' + i18next.t('Upgrade failed.') + '</strong><br>' + xhr.status + ': ' + xhr.statusText;\n                    }\n                } else if (error) {\n                    errorMessage = '<strong>' + i18next.t('Upgrade failed.') + '</strong><br>' + error;\n                }\n\n                $applyStatus.html(`<div class=\"alert alert-danger\" style=\"background-color: #f8d7da; border-color: #f5c6cb; color: #721c24;\">\n                <i class=\"fa-solid fa-times-circle mr-2\"></i>${errorMessage}\n            </div>`);\n                $statusIcon.html('<i class=\"fa-solid fa-times text-danger\"></i>');\n                $button.prop('disabled', false);\n            });\n    });\n}\n\n/**\n * Download backup file\n * @param {string} filename - The backup filename to download\n */\nfunction downloadBackup(filename) {\n    window.location = window.CRM.root + \"/api/database/download/\" + filename;\n    $(\"#backupStatus\").html(`<div class=\"alert alert-info\">\n        <i class=\"fa-solid fa-info-circle mr-2\"></i>${i18next.t('Backup Downloaded, Copy on server removed')}\n    </div>`);\n}\n\n// Export functions to global scope for onclick handlers\nwindow.UpgradeWizard = {\n    downloadBackup\n};\n\n/**\n * Setup pre-release upgrade toggle\n */\nfunction setupPrereleaseToggle() {\n    const $toggle = $('#bAllowPrereleaseUpgrade');\n    let isTogglingProgrammatically = false;\n\n    // Initialize bootstrap-toggle (checkbox is already set to correct value from PHP)\n    $toggle.bootstrapToggle();\n\n    // Handle toggle change\n    $toggle.change(function () {\n        if (isTogglingProgrammatically) {\n            return;\n        }\n\n        const newValue = $(this).prop('checked');\n        const $spinner = $(\"#upgradeSpinner\");\n\n        // Show spinner\n        $spinner.addClass('active');\n\n        // Save the new value (convert boolean to string '1' or '0')\n        window.CRM.APIRequest({\n            method: 'POST',\n            path: 'system/config/bAllowPrereleaseUpgrade',\n            data: JSON.stringify({ value: newValue ? '1' : '0' })\n        }).done(function () {\n            // Refresh upgrade info from GitHub\n            window.CRM.APIRequest({\n                method: 'POST',\n                path: 'systemupgrade/refresh-upgrade-info'\n            }).done(function (data) {\n                $spinner.removeClass('active');\n                window.CRM.notify(i18next.t('Setting saved. Reloading page...'), {\n                    type: 'success',\n                    delay: 1500\n                });\n                \n                // Reload the page after a short delay\n                setTimeout(function () {\n                    window.location.reload();\n                }, 1500);\n            }).fail(function () {\n                $spinner.removeClass('active');\n                window.CRM.notify(i18next.t('Failed to refresh upgrade information. Please try again.'), {\n                    type: 'error',\n                    delay: 5000\n                });\n                \n                // Revert the toggle on failure\n                isTogglingProgrammatically = true;\n                $toggle.prop('checked', !newValue).change();\n                isTogglingProgrammatically = false;\n            });\n        }).fail(function () {\n            $spinner.removeClass('active');\n            window.CRM.notify(i18next.t('Failed to save setting. Please try again.'), {\n                type: 'error',\n                delay: 5000\n            });\n            \n            // Revert the toggle\n            isTogglingProgrammatically = true;\n            $toggle.prop('checked', !newValue).change();\n            isTogglingProgrammatically = false;\n        });\n    });\n}\n\n/**\n * Setup refresh from GitHub button\n */\nfunction setupRefreshButton() {\n    $('#refreshFromGitHub').click(function () {\n        const $button = $(this);\n        const $spinner = $(\"#upgradeSpinner\");\n        const $icon = $button.find('i');\n        \n        // Disable button and show spinner\n        $button.prop('disabled', true);\n        $icon.removeClass('fa-sync').addClass('fa-circle-notch fa-spin');\n        $spinner.addClass('active');\n\n        // Call refresh API\n        window.CRM.APIRequest({\n            method: 'POST',\n            path: 'systemupgrade/refresh-upgrade-info'\n        }).done(function (data) {\n            $spinner.removeClass('active');\n            window.CRM.notify(i18next.t('Upgrade information refreshed. Reloading page...'), {\n                type: 'success',\n                delay: 1500\n            });\n            \n            // Reload the page after a short delay\n            setTimeout(function () {\n                window.location.reload();\n            }, 1500);\n        }).fail(function (xhr, status, error) {\n            $spinner.removeClass('active');\n            $button.prop('disabled', false);\n            $icon.removeClass('fa-circle-notch fa-spin').addClass('fa-sync');\n            \n            \n            let errorMessage = i18next.t('Failed to refresh upgrade information from GitHub.');\n            if (xhr.responseJSON && xhr.responseJSON.message) {\n                errorMessage = xhr.responseJSON.message;\n            }\n            \n            window.CRM.notify(errorMessage, {\n                type: 'error',\n                delay: 5000\n            });\n        });\n    });\n}\n\n/**\n * Setup force reinstall button - allows re-downloading and applying the current version\n */\nfunction setupForceReinstallButton() {\n    $('#forceReinstall').click(function () {\n        // Confirm the action\n        if (!confirm(i18next.t('This will re-download and re-apply the current version. This can fix corrupted or modified files. Continue?'))) {\n            return;\n        }\n\n        // Show the upgrade wizard card if hidden\n        $('#upgrade-wizard-card').addClass('show');\n\n        // Reset the stepper to the beginning and then navigate to the backup step\n        upgradeStepper.to(0);\n        \n        // Small delay to ensure stepper is ready, then advance to backup step\n        setTimeout(function() {\n            upgradeStepper.to(1); // Go to backup step\n        }, 100);\n\n        // Scroll to the wizard\n        $('html, body').animate({\n            scrollTop: $('#upgrade-wizard-card').offset().top - 20\n        }, 500);\n\n        window.CRM.notify(i18next.t('Force re-install initiated. Please backup your database before applying.'), {\n            type: 'info',\n            delay: 5000\n        });\n    });\n}\n\n\n//# sourceURL=webpack://churchcrm/./webpack/upgrade-wizard-app.js?\n}",
                );

                /***/
            },

        /***/ "./webpack/upgrade-wizard.css":
            /*!************************************!*\
  !*** ./webpack/upgrade-wizard.css ***!
  \************************************/
            /***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
                "use strict";
                eval(
                    "{__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://churchcrm/./webpack/upgrade-wizard.css?\n}",
                );

                /***/
            },

        /***/ "./webpack/upgrade-wizard.js":
            /*!***********************************!*\
  !*** ./webpack/upgrade-wizard.js ***!
  \***********************************/
            /***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
                "use strict";
                eval(
                    '{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _upgrade_wizard_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./upgrade-wizard.css */ "./webpack/upgrade-wizard.css");\n/* harmony import */ var _upgrade_wizard_app_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./upgrade-wizard-app.js */ "./webpack/upgrade-wizard-app.js");\n// Upgrade Wizard webpack entry point\n\n\n\n\n//# sourceURL=webpack://churchcrm/./webpack/upgrade-wizard.js?\n}',
                );

                /***/
            },

        /******/
    };
    /************************************************************************/
    /******/ // The module cache
    /******/ var __webpack_module_cache__ = {};
    /******/
    /******/ // The require function
    /******/ function __webpack_require__(moduleId) {
        /******/ // Check if module is in cache
        /******/ var cachedModule = __webpack_module_cache__[moduleId];
        /******/ if (cachedModule !== undefined) {
            /******/ return cachedModule.exports;
            /******/
        }
        /******/ // Create a new module (and put it into the cache)
        /******/ var module = (__webpack_module_cache__[moduleId] = {
            /******/ // no module.id needed
            /******/ // no module.loaded needed
            /******/ exports: {},
            /******/
        });
        /******/
        /******/ // Execute the module function
        /******/ __webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
        /******/
        /******/ // Return the exports of the module
        /******/ return module.exports;
        /******/
    }
    /******/
    /************************************************************************/
    /******/ /* webpack/runtime/compat get default export */
    /******/ (() => {
        /******/ // getDefaultExport function for compatibility with non-harmony modules
        /******/ __webpack_require__.n = (module) => {
            /******/ var getter =
                module && module.__esModule ? /******/ () => module["default"] : /******/ () => module;
            /******/ __webpack_require__.d(getter, { a: getter });
            /******/ return getter;
            /******/
        };
        /******/
    })();
    /******/
    /******/ /* webpack/runtime/define property getters */
    /******/ (() => {
        /******/ // define getter functions for harmony exports
        /******/ __webpack_require__.d = (exports, definition) => {
            /******/ for (var key in definition) {
                /******/ if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
                    /******/ Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
                    /******/
                }
                /******/
            }
            /******/
        };
        /******/
    })();
    /******/
    /******/ /* webpack/runtime/hasOwnProperty shorthand */
    /******/ (() => {
        /******/ __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
        /******/
    })();
    /******/
    /******/ /* webpack/runtime/make namespace object */
    /******/ (() => {
        /******/ // define __esModule on exports
        /******/ __webpack_require__.r = (exports) => {
            /******/ if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
                /******/ Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
                /******/
            }
            /******/ Object.defineProperty(exports, "__esModule", { value: true });
            /******/
        };
        /******/
    })();
    /******/
    /************************************************************************/
    /******/
    /******/ // startup
    /******/ // Load entry module and return exports
    /******/ // This entry module can't be inlined because the eval devtool is used.
    /******/ var __webpack_exports__ = __webpack_require__("./webpack/upgrade-wizard.js");
    /******/
    /******/
})();
